<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pianeta 3D – Laboratorio</title>

  <style>
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      margin:0;
      background:#f6f7fb;
      color:#111;
    }
    header{
      position:sticky;
      top:0;
      background:#fff;
      padding:12px 14px;
      border-bottom:1px solid #e6e7ee;
      z-index:5;
    }
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    h1{font-size:16px;margin:0}
    input,button,textarea{
      padding:10px;
      border:1px solid #d9dbe7;
      border-radius:10px;
      background:#fff;
      font-size:14px;
    }
    textarea{resize:vertical;min-height:50px}
    button{cursor:pointer}
    .wrap{padding:12px}
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin-left:auto}
    .tab{
      padding:8px 12px;
      border:1px solid #d9dbe7;
      border-radius:999px;
      background:#fff;
      cursor:pointer;
      font-size:13px;
    }
    .tab.active{
      border-color:#7fb0ff;
      background:#eef4ff;
    }
    .panel{
      background:#fff;
      border:1px solid #e6e7ee;
      border-radius:12px;
      padding:12px;
    }
    .hide{display:none}
    .label{font-size:12px;color:#555;margin:6px 0 4px}
    .stack > *{margin-bottom:10px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{font-size:12px;padding:8px;border-bottom:1px solid #eee;text-align:left}
    .muted{color:#666;font-size:12px}

    .board{
      display:grid;
      grid-template-columns:repeat(6,minmax(220px,1fr));
      gap:10px;
    }
    @media(max-width:1200px){.board{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:640px){.board{grid-template-columns:1fr}}

    .col{
      background:#fff;
      border:1px solid #e6e7ee;
      border-radius:12px;
      padding:10px;
    }
    .col h2{
      font-size:14px;
      margin:0 0 8px 0;
      display:flex;
      justify-content:space-between;
    }
    .card{
      border:1px solid #e6e7ee;
      border-radius:12px;
      padding:10px;
      margin-bottom:8px;
      background:#fff;
    }
    .title{font-weight:700;font-size:14px;margin-bottom:6px}
    .meta{font-size:12px;color:#444;line-height:1.4}
    .actions{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .small{font-size:12px;padding:6px 8px}
    .ok{background:#f4fff7;border-color:#cfe9d6}
    .danger{background:#fff5f5;border-color:#ffd0d0}
    .pill{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid #ddd;
    }
    .stockZero{background:#ffecec}
  </style>
</head>

<body>

<header>
  <div class="row">
    <h1>Pianeta 3D – Laboratorio</h1>

    <div class="tabs">
      <button id="tab-new" class="tab active" onclick="showNew()">Nuovo ordine</button>
      <button id="tab-prep" class="tab" onclick="showPrep()">Produzione</button>
      <button id="tab-sales" class="tab" onclick="openSales()">Vendite</button>
      <button id="tab-stock" class="tab" onclick="showStock()">Magazzino</button>
      <button id="tab-done" class="tab" onclick="showDone()">Completati</button>
      <button id="tab-done-simple" class="tab" onclick="showDoneSimple()">Completati (semplice)</button>
      <button id="tab-settings" class="tab" onclick="showSettings()">Impostazioni</button>
    </div>
  </div>
</header>

<div class="wrap">

  <!-- NUOVO ORDINE -->
  <div id="page-new" class="panel">
    <div class="stack">
      <input id="cliente" placeholder="Cliente">
      <input id="sito" placeholder="Sito vendita">
      <input id="progetto" placeholder="Numero progetto">
      <input id="prezzo" type="number" step="0.01" placeholder="Prezzo €">
      <button class="small ok" onclick="addTempItem()">+ Aggiungi progetto</button>
      <div id="tempItemsWrap"></div>
      <textarea id="note" placeholder="Note"></textarea>
      <button class="ok" onclick="addOrder()">INVIA ORDINE</button>
    </div>

    <hr>
    <b>Ordini attivi</b>
    <table>
      <thead>
        <tr>
          <th>Articolo</th><th>Cliente</th><th>Sito</th>
          <th>€</th><th>Stato</th><th>Creato</th><th>Agg.</th>
        </tr>
      </thead>
      <tbody id="activeTbody"></tbody>
    </table>
  </div>

  <!-- PRODUZIONE -->
  <div id="page-prep" class="hide">
    <div class="panel">
      <div class="board" id="board"></div>
    </div>
  </div>

  <!-- VENDITE -->
  <div id="page-sales" class="hide">
    <div class="panel">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h3 style="margin:0">Vendite</h3>
        <button class="small danger" onclick="lockSales()">Blocca vendite</button>
      </div>

      <div class="row" style="justify-content:flex-start;align-items:center;margin-top:10px">
        <button class="small" onclick="salesPrevMonth()">←</button>
        <b id="salesMonthLabel" style="margin:0 8px">Mese</b>
        <button class="small" onclick="salesNextMonth()">→</button>
      </div>

      <div id="salesDow" class="row" style="margin-top:10px"></div>

      <div id="salesCal"
           style="display:grid;grid-template-columns:repeat(7, minmax(40px,1fr));gap:6px;margin-top:6px">
      </div>

      <hr>
      <b id="salesSelectedLabel">Dettaglio giorno:</b>
      <div id="salesDayDetails" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- MAGAZZINO -->
  <div id="page-stock" class="hide">
    <div class="panel">
      <input id="stkArticolo" placeholder="Numero progetto">
      <input id="stkQty" type="number" placeholder="Quantità">
      <button onclick="upsertStock()">Salva</button>
      <table><tbody id="stockTbody"></tbody></table>
    </div>
  </div>

  <!-- COMPLETATI -->
  <div id="page-done" class="hide">
    <div class="panel">
      <table><tbody id="doneTbody"></tbody></table>
    </div>
  </div>

  <!-- COMPLETATI SEMPLICE -->
  <div id="page-done-simple" class="hide">
    <div class="panel">
      <table><tbody id="doneSimpleTbody"></tbody></table>
    </div>
  </div>

  <!-- IMPOSTAZIONI -->
  <div id="page-settings" class="hide">
    <div class="panel">
      <button onclick="clearCompleted()">Cancella completati</button>
      <button onclick="clearAllData()">RESET TOTALE</button>
    </div>
  </div>

</div>

<!-- SUPABASE + APP -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="app.js"></script>

</body>
</html>
